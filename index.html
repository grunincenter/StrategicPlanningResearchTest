<!DOCTYPE html>
<html lang="en">
<head>
Â <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Strategic Planning Research Version 2 - Comparative Analysis</title>

Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
Â  Â  Â  Â  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/SVSLyojsvWv9Ue8ExI="
Â  Â  Â  Â  crossorigin=""/>
Â  Â  Â  Â  <style>
Â  Â  Â  Â  /* --- General and Layout Styles --- */
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
Â  Â  Â  Â  Â  Â  background: #f5f5f5;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }

Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 1400px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid #00abce;
Â  Â  Â  Â  Â  Â  padding-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header h1 {
Â  Â  Â  Â  Â  Â  color: #330662;
Â  Â  Â  Â  Â  Â  font-size: 28px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header p {
Â  Â  Â  Â  Â  Â  color: #330662;
Â  Â  Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- View Controls (Tabs) --- */
Â  Â  Â  Â  .view-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: baseline;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-header {
Â  Â  Â  Â  Â  Â  color: #999;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  padding: 8px 10px;
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-header:hover:not(.active) {
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-header.active {
Â  Â  Â  Â  Â  Â  color: #330662;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  border-left: 4px solid #702b9d;
Â  Â  Â  Â  Â  Â  cursor: default;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-header:not(.active)::after {
Â  Â  Â  Â  Â  Â  content: '|';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  right: -8px;
Â  Â  Â  Â  Â  Â  color: #ddd;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-header:last-child::after {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-container {
Â  Â  Â  Â  Â  Â  min-height: 500px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-panel {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  padding-top: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .view-panel.active {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Dynamic Loading & Error State --- */
Â  Â  Â  Â  .loading {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 50px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  color: #702b9d;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .error {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 50px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  color: #cc3300;
Â  Â  Â  Â  Â  Â  background: #ffebeb;
Â  Â  Â  Â  Â  Â  border: 1px solid #cc3300;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }


Â  Â  Â  Â  /* --- Executive Summary Styles --- */
Â  Â  Â  Â  .executive-summary {
Â  Â  Â  Â  Â  Â  max-width: 1000px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  .summary-intro {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #330662 0%, #702b9d 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .summary-intro h2 {
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .summary-intro p {
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  Â  Â  opacity: 0.95;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .metrics-bar {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #f9f9f9 0%, #e8f4f8 100%);
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid #00abce;
Â  Â  Â  Â  }

Â  Â  Â  Â  .metric {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  min-width: 120px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .metric-value {
Â  Â  Â  Â  Â  Â  font-size: 32px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #330662;
Â  Â  Â  Â  }

Â  Â  Â  Â  .metric-label {
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Table/Card Styles (for all dynamic tabs) --- */
Â  Â  Â  Â  .data-table-container, .card-gallery {
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .data-table {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .data-table th, .data-table td {
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #e0e0e0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .data-table th {
Â  Â  Â  Â  Â  Â  background: #702b9d;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid #330662;
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  Â  Â  vertical-align: top;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* FIX: Style for the dynamically inserted tier headers in the shortlist table */
Â  Â  Â  Â  .data-table .commitment-header th {
Â  Â  Â  Â  Â  Â  background: #9d7cc4 !important; /* Lighter purple */
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  position: static; /* Prevent tier headers from sticking with the main header */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Style for the checkmark/cross cells */
Â  Â  Â  Â  .data-table .yes-cell { color: #00abce; font-weight: bold; }
Â  Â  Â  Â  .data-table .no-cell { color: #ccc; }


Â  Â  Â  Â  /* --- Field Strength Dot Indicators --- */
Â  Â  Â  Â  .strength-indicator {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 3px;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dot {
Â  Â  Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  Â  Â  height: 8px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  opacity: 0.3;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dot.filled {
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dot.se-dot { background-color: #702b9d; } /* Purple */
Â  Â  Â  Â  .dot.ii-dot { background-color: #00abce; } /* Teal */
Â  Â  Â  Â  .dot.sd-dot { background-color: #FFD700; } /* Gold */
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Card Gallery (for Centers, Clinics, Events, Stories) --- */
Â  Â  Â  Â  .card-gallery {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  Â  Â  padding: 10px 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .data-card {
Â  Â  Â  Â  Â  Â  background: #fdfdfd;
Â  Â  Â  Â  Â  Â  border: 1px solid #eee;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 5px rgba(0,0,0,0.05);
Â  Â  Â  Â  Â  Â  transition: transform 0.2s;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .data-card.highlight {
Â  Â  Â  Â  Â  Â  border: 2px solid #702b9d;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(112, 43, 157, 0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-title {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  color: #330662;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #e8e8e8;
Â  Â  Â  Â  Â  Â  padding-bottom: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-subtitle {
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  color: #00abce;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-description {
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-badges {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  gap: 5px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .badge {
Â  Â  Â  Â  Â  Â  font-size: 10px;
Â  Â  Â  Â  Â  Â  padding: 4px 8px;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .tier-badge { background-color: #702b9d; }
Â  Â  Â  Â  .category-badge { background-color: #333; }

Â  Â  Â  Â  .card-footer {
Â  Â  Â  Â  Â  Â  border-top: 1px solid #f0f0f0;
Â  Â  Â  Â  Â  Â  padding-top: 10px;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  color: #999;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-footer a {
Â  Â  Â  Â  Â  Â  color: #00abce;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Footer and Modal (Retained) --- */
Â  Â  Â  Â  .footer-note {
Â  Â  Â  Â  Â  Â  margin-top: 40px;
Â  Â  Â  Â  Â  Â  padding-top: 20px;
Â  Â  Â  Â  Â  Â  border-top: 1px solid #e0e0e0;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  color: #999;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal {
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  overflow: auto;Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.4);Â 
Â  Â  Â  Â  Â  Â  padding-top: 60px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background-color: #fefefe;
Â  Â  Â  Â  Â  Â  margin: 5% auto;Â 
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid #888;
Â  Â  Â  Â  Â  Â  width: 80%;Â 
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .close-btn {
Â  Â  Â  Â  Â  Â  color: #aaa;
Â  Â  Â  Â  Â  Â  float: right;
Â  Â  Â  Â  Â  Â  font-size: 28px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  .close-btn:hover,
Â  Â  Â  Â  .close-btn:focus {
Â  Â  Â  Â  Â  Â  color: #000;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  #mapid {
Â  Â  Â  Â  Â  Â  height: 600px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <h1>Strategic Planning Research Version 2</h1>
Â  Â  Â  Â  Â  Â  <p>Comparative U.S. Law School Programmatic Analysis</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="view-controls">
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('summary')">Executive Summary</div>
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('shortlist')">Short List</div>
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('map')">Map</div>
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('centers')">Institutes, Centers & Programs</div>
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('clinics')">Clinics</div>
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('events')">Events</div>
Â  Â  Â  Â  Â  Â  <div class="view-header" onclick="showView('stories')">Stories & Emerging Programs</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="view-container">
Â  Â  Â  Â  Â  Â  <div id="loading-view" class="view-panel active loading">
Â  Â  Â  Â  Â  Â  Â  Â  <p>Loading data from /data/ files...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="error-view" class="view-panel error" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Data Loading Error</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Could not load all required CSV files. Please ensure the `/data/` folder exists and contains all five files (`schools.csv`, `centers.csv`, `clinics.csv`, `events.csv`, `stories.csv`).</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Check the browser console for specific errors (e.g., file not found).</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="summary-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="executive-summary">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-intro">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>Research Overview: U.S. Law School Landscape</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>This dashboard presents research compiled on U.S. Law Schools, focusing on their ranking, tier status, and confirmed/potential programming relevant to specific legal fields. Data is now loaded dynamically from CSV files in the `/data/` folder. The goal is to position NYU Law as the benchmark and map the competitive landscape.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metrics-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-value" id="total-schools">...</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-label">TOTAL SCHOOLS (From schools.csv)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-value" id="strong-count">...</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-label">SCHOOLS WITH STRONG COMMITMENT</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-value" id="total-centers">...</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-label">TOTAL CENTERS/INSTITUTES FOUND</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-value" id="total-clinics">...</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-label">TOTAL CLINICS FOUND</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Executive Summary Narrative</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="summary-narrative" style="padding: 10px; border-left: 3px solid #00abce;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Waiting for data to load... Once data is loaded from `schools.csv`, this section will automatically populate with high-level statistics and key findings.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="shortlist-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Short List: Institutional Commitment Matrix</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-bottom: 20px; color: #666; font-size: 15px;">Matrix view of schools with demonstrated institutional commitment, organized by tier. Displays tier badge, field strength dots (SE/II/SD), and offering checkmarks.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="data-table-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="data-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr id="shortlist-table-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 250px;">School</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>SE (Social Ent.)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>II (Impact Inv.)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>SD (Sust. Dev.)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Has Center</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Has Clinic</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Has Events</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Partnership</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="shortlist-table-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="8">Data loading...</td></tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="map-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Map: Geographic Visualization</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-bottom: 20px; color: #666; font-size: 15px;">Map will show the location of all schools with relevant activity...</p>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="mapid"></div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="centers-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Institutes, Centers & Programs</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-bottom: 20px; color: #666; font-size: 15px;">Card-based display of all centers/institutes with relevant programming. NYU appears first; short list schools highlighted in purple; all other schools shown in gray.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-gallery" id="centers-card-gallery">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Waiting for data from `centers.csv`...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="clinics-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Clinics</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-bottom: 20px; color: #666; font-size: 15px;">Card-based display for clinics serving social entrepreneurs, impact investors, or sustainable development clients. Filterable by short list vs. all schools.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-gallery" id="clinics-card-gallery">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Waiting for data from `clinics.csv`...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="events-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Symposia, Conferences, and Recurring Events</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-bottom: 20px; color: #666; font-size: 15px;">Shows event name, type, whether recurring or one-time, field strength, and last held date. Useful for tracking field activity and partnership opportunities.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-gallery" id="events-card-gallery">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Waiting for data from `events.csv`...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="stories-view" class="view-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Stories & Emerging Programs</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-bottom: 20px; color: #666; font-size: 15px;">Qualitative card gallery for items that don't fit neatly into other categories: new programs, one-off events, and notable details.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-gallery" id="stories-card-gallery">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Waiting for data from `stories.csv`...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="footer-note">
Â  Â  Â  Â  Â  Â  Data loaded dynamically from CSV files in the /data/ folder. Data verification date will be reflected in the source files.
Â  Â  Â  Â  </div>

Â  Â  </div>Â 
Â  Â Â 
Â  Â  <div id="school-modal" class="modal">
Â  Â  Â  Â  </div>

Â  Â  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
Â  Â  Â  Â  integrity="sha256-20n6aJ6wD2FjLzUaD9n7rW/K0M1z/0l9G8Z6g3V/h2Q="
Â  Â  Â  Â  crossorigin=""></script>
Â  Â Â 
Â  Â  <script src="map_script.js"></script>
Â  Â  <script>
Â  Â  Â  Â  // Data storage object for all loaded CSV data
Â  Â  Â  Â  const data = {
Â  Â  Â  Â  Â  Â  schools: [],
Â  Â  Â  Â  Â  Â  centers: [],
Â  Â  Â  Â  Â  Â  clinics: [],
Â  Â  Â  Â  Â  Â  events: [],
Â  Â  Â  Â  Â  Â  stories: []
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // CSV Paths
Â  Â  Â  Â  const csvPaths = {
Â  Â  Â  Â  Â  Â  schools: './data/schools.csv',
Â  Â  Â  Â  Â  Â  centers: './data/centers.csv',
Â  Â  Â  Â  Â  Â  clinics: './data/clinics.csv',
Â  Â  Â  Â  Â  Â  events: './data/events.csv',
Â  Â  Â  Â  Â  Â  stories: './data/stories.csv'
Â  Â  Â  Â  };

Â  Â  Â  Â  // Utility function to parse CSV text into an array of objects
Â  Â  Â  Â  function parseCSV(csvText) {
Â  Â  Â  Â  Â  Â  const lines = csvText.trim().split('\n');
Â  Â  Â  Â  Â  Â  if (lines.length === 0) return [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // NOTE: Simple split(',') is used here but may fail if data contains escaped commas.
Â  Â  Â  Â  Â  Â  // For production, a robust CSV library (like PapaParse) is recommended.
Â  Â  Â  Â  Â  Â  const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
Â  Â  Â  Â  Â  Â  const result = [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for (let i = 1; i < lines.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const values = lines[i].split(',');
Â  Â  Â  Â  Â  Â  Â  Â  if (values.length !== headers.length) continue;Â 

Â  Â  Â  Â  Â  Â  Â  Â  const row = {};
Â  Â  Â  Â  Â  Â  Â  Â  headers.forEach((header, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Trim and handle boolean/numeric values
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let value = values[index].trim().replace(/"/g, ''); // Remove quotes too
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value.toLowerCase() === 'true') value = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (value.toLowerCase() === 'false') value = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (!isNaN(value) && value !== '') value = Number(value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row[header] = value;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  result.push(row);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return result;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Main data loading function (fetches all CSVs concurrently)
Â  Â  Â  Â  async function loadData() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const fetchPromises = Object.keys(csvPaths).map(key =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetch(csvPaths[key]).then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Failed to load ${csvPaths[key]}: ${response.statusText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return response.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).then(csvText => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data[key] = parseCSV(csvText);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all(fetchPromises);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Data loaded successfully
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-view').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  initializeDashboard();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Dashboard Data Loading Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-view').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('error-view').style.display = 'block';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Helper function to generate field strength dots (0-3)
Â  Â  Â  Â  function generateStrengthDots(strength, field) {
Â  Â  Â  Â  Â  Â  let html = '<div class="strength-indicator">';
Â  Â  Â  Â  Â  Â  const colorClass = field === 'se' ? 'se-dot' : field === 'ii' ? 'ii-dot' : 'sd-dot';
Â  Â  Â  Â  Â  Â  for (let i = 1; i <= 3; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const isFilled = i <= strength;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="dot ${colorClass} ${isFilled ? 'filled' : ''}"></div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  html += '</div>';
Â  Â  Â  Â  Â  Â  return html;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- RENDERING FUNCTIONS ---

Â  Â  Â  Â  function renderExecutiveSummary() {
Â  Â  Â  Â  Â  Â  const totalSchools = data.schools.length;
Â  Â  Â  Â  Â  Â  const strongCount = data.schools.filter(s => s.tier === 'Strong Institutional Commitment').length;
Â  Â  Â  Â  Â  Â  const totalCenters = data.centers.length;
Â  Â  Â  Â  Â  Â  const totalClinics = data.clinics.length;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('total-schools').textContent = totalSchools;
Â  Â  Â  Â  Â  Â  document.getElementById('strong-count').textContent = strongCount;
Â  Â  Â  Â  Â  Â  document.getElementById('total-centers').textContent = totalCenters;
Â  Â  Â  Â  Â  Â  document.getElementById('total-clinics').textContent = totalClinics;

Â  Â  Â  Â  Â  Â  // Placeholder narrative update
Â  Â  Â  Â  Â  Â  document.getElementById('summary-narrative').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  The research identified **${totalSchools}** schools with relevant activity.Â 
Â  Â  Â  Â  Â  Â  Â  Â  A total of **${strongCount}** schools meet the criteria for a "Strong Institutional Commitment."
Â  Â  Â  Â  Â  Â  Â  Â  We tracked **${totalCenters}** unique centers/institutes and **${totalClinics}** specialized clinics across the schools.Â 
Â  Â  Â  Â  Â  Â  Â  Â  Further analysis of this data will inform the 3-5 year strategic plan.
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderShortList() {
Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('shortlist-table-body');
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Filter out schools without a tier, then group by tier
Â  Â  Â  Â  Â  Â  const tieredSchools = data.schools.filter(s => s.tier);

Â  Â  Â  Â  Â  Â  const schoolsByTier = tieredSchools.reduce((acc, school) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!acc[school.tier]) acc[school.tier] = [];
Â  Â  Â  Â  Â  Â  Â  Â  acc[school.tier].push(school);
Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  }, {});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const tierOrder = ['Strong Institutional Commitment', 'Substantial Institutional Commitment', 'Some Institutional Commitment'];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  tierOrder.forEach(tier => {
Â  Â  Â  Â  Â  Â  Â  Â  if (schoolsByTier[tier]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="commitment-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th colspan="8">${tier}*</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  schoolsByTier[tier].sort((a, b) => a.school_name.localeCompare(b.school_name)).forEach(school => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hasCenter = school.has_center ? '<span class="yes-cell">X</span>' : '<span class="no-cell">-</span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hasClinic = school.has_clinic ? '<span class="yes-cell">X</span>' : '<span class="no-cell">-</span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hasEvents = school.has_events ? '<span class="yes-cell">X</span>' : '<span class="no-cell">-</span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hasPartnership = school.has_partnership ? `<span class="yes-cell" title="${school.partnership_note}">X</span>` : '<span class="no-cell">-</span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // NYU (school_id = 1) is always first in its tier
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nameCell = school.school_id === 1Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<span class="school-name" style="color: #702b9d;">${school.school_name} (Benchmark)</span>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `<span class="school-name" onclick="showSchoolDetails(${school.school_id})" style="cursor: pointer; text-decoration: underline;">${school.school_name}</span>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${nameCell}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${generateStrengthDots(school.se_strength, 'se')}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${generateStrengthDots(school.ii_strength, 'ii')}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${generateStrengthDots(school.sd_strength, 'sd')}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center;">${hasCenter}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center;">${hasClinic}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center;">${hasEvents}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center;">${hasPartnership}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  tbody.innerHTML = html || '<tr><td colspan="8">No school data available. Please check schools.csv.</td></tr>';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderProgramCards(dataArray, containerId, highlightCondition) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById(containerId);
Â  Â  Â  Â  Â  Â  if (!container) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (dataArray.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<p>No data available. Please populate the relevant CSV file.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Ensure NYU's program (if applicable) is first
Â  Â  Â  Â  Â  Â  const sortedData = dataArray.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (a.school_id === 1) return -1;
Â  Â  Â  Â  Â  Â  Â  Â  if (b.school_id === 1) return 1;
Â  Â  Â  Â  Â  Â  Â  Â  return 0;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  sortedData.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const school = data.schools.find(s => s.school_id === item.school_id) || { school_name: 'Unknown School', tier: 'N/A' };
Â  Â  Â  Â  Â  Â  Â  Â  const isHighlight = highlightCondition(school, item);
Â  Â  Â  Â  Â  Â  Â  Â  const highlightClass = isHighlight ? 'highlight' : '';

Â  Â  Â  Â  Â  Â  Â  Â  const fieldStrengthHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-badges" style="margin-top: 5px; justify-content: flex-start;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="badge tier-badge">${school.tier}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 11px; margin-top: 5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SE: ${generateStrengthDots(item.se_strength, 'se')} &nbsp;&nbsp;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  II: ${generateStrengthDots(item.ii_strength, 'ii')} &nbsp;&nbsp;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SD: ${generateStrengthDots(item.sd_strength, 'sd')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  // Common card structure for centers, clinics, and events
Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="data-card ${highlightClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="card-title">${item.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-subtitle">${school.school_name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">${item.description || 'No description provided.'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${fieldStrengthHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.year_founded ? `Founded: ${item.year_founded}` : item.last_held ? `Last Held: ${item.last_held}` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.url ? ` | <a href="${item.url}" target="_blank">External Link</a>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderStories() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('stories-card-gallery');
Â  Â  Â  Â  Â  Â  if (!container) return;

Â  Â  Â  Â  Â  Â  if (data.stories.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<p>No data available. Please populate stories.csv.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  data.stories.forEach(story => {
Â  Â  Â  Â  Â  Â  Â  Â  const school = data.schools.find(s => s.school_id === story.school_id) || { school_name: 'Unknown School', tier: 'N/A' };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const fieldTags = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  story.se_tag ? `<span class="badge" style="background-color: #702b9d;">SE</span>` : '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  story.ii_tag ? `<span class="badge" style="background-color: #00abce;">II</span>` : '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  story.sd_tag ? `<span class="badge" style="background-color: #FFD700; color: #333;">SD</span>` : ''
Â  Â  Â  Â  Â  Â  Â  Â  ].join(' ');

Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="data-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="card-title">${story.headline}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-subtitle">${school.school_name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-badges">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="badge category-badge" style="background-color: #555;">${story.category}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${fieldTags}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">${story.description || 'No description provided.'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Follow-up: ${story.follow_up_note || 'N/A'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${story.url ? ` | <a href="${story.url}" target="_blank">Source</a>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  Â  }

Â  Â  Â  Â  function initializeDashboard() {
Â  Â  Â  Â  Â  Â  // 1. Render all dynamic content
Â  Â  Â  Â  Â  Â  renderExecutiveSummary();
Â  Â  Â  Â  Â  Â  renderShortList();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Highlight NYU and any schools with 'Strong Institutional Commitment'
Â  Â  Â  Â  Â  Â  const highlightSchools = (school) => school.school_id === 1 || school.tier === 'Strong Institutional Commitment';

Â  Â  Â  Â  Â  Â  renderProgramCards(data.centers, 'centers-card-gallery', highlightSchools);
Â  Â  Â  Â  Â  Â  renderProgramCards(data.clinics, 'clinics-card-gallery', highlightSchools);
Â  Â  Â  Â  Â  Â  renderProgramCards(data.events, 'events-card-gallery', highlightSchools);
Â  Â  Â  Â  Â  Â  renderStories();

Â  Â  Â  Â  Â  Â  // 2. Set the initial view (Summary)
Â  Â  Â  Â  Â  Â  showView('summary');Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- CORE NAVIGATION/MODAL FUNCTIONS (FIXED BELOW) ---

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * CORE FUNCTION: Toggles the active view and updates the header tabs.
Â  Â  Â  Â  Â * FIX: Added map.invalidateSize() call for the map view.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function showView(viewId) {
Â  Â  Â  Â  Â  Â  // Hide all view panels
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.view-panel').forEach(panel => {
Â  Â  Â  Â  Â  Â  Â  Â  panel.classList.remove('active');
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Activate the correct view panel
Â  Â  Â  Â  Â  Â  document.getElementById(viewId + '-view').classList.add('active');

Â  Â  Â  Â  Â  Â  // Update tab headers
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.view-header').forEach(header => {
Â  Â  Â  Â  Â  Â  Â  Â  header.classList.remove('active');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.querySelector(`.view-header[onclick="showView('${viewId}')"]`).classList.add('active');

Â  Â  Â  Â  Â  Â  // ðŸŒŸ CRITICAL FIX: Tell the map to check its size after its container becomes visible.
Â  Â  Â  Â  Â  Â  if (viewId === 'map' && typeof map !== 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  // We use a small delay (100ms) to ensure the CSS transition is complete
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.invalidateSize();
Â  Â  Â  Â  Â  Â  Â  Â  }, 100); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } 
        // --- END of showView function ---


        // Function to handle showing school details (using the modal, if needed later)
        function showSchoolDetails(schoolId) {
            // Find the school data
            const school = data.schools.find(s => s.school_id === schoolId);
            if (!school) return;
            
            // Logic to render school details in the modal goes here
            const modal = document.getElementById('school-modal');
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-btn" onclick="document.getElementById('school-modal').style.display = 'none'">&times;</span>
                    <h2>${school.school_name}</h2>
                    <p><strong>Tier:</strong> ${school.tier}</p>
                    <p><strong>URL:</strong> <a href="${school.school_url}" target="_blank">${school.school_url}</a></p>
                    <p>... more details will be added here ...</p>
                </div>
            `;
            modal.style.display = 'block';
        }

        // Close the modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('school-modal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

Â  Â  Â  Â  // --- INITIATE DASHBOARD LOADING ---
Â  Â  Â  Â  loadData();
Â  Â  </script>
</body>
</html>
